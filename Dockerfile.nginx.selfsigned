# This builds the stabug.com nginx reverse proxy.
#
# starbug.com static content is loaded from http on port 80

# AAI TLS content (for browser location in AAI calculations) is
# reverse proxied to the aai gunicorn app.  It expects this app to be
# running on aai-gunicorn-00

# Names must be coordinated with the gunicorn WSGI server. See also www/gunicorn.sh
#
# TODO load balanced nginx
#
# from https://hub.docker.com/_/nginx/
#
# to build:         docker build -f Dockerfile.nginx.selfsigned -t nginx-ss.starbug.com .
#
# create network:   docker network create nginx-proxy
# to run with TLS:  docker run --net nginx-proxy --name nginx-ss-00.starbug.com -v /var/run/docker.sock:/tmp/docker.sock -d -p 80:80 -p 443:443 nginx-ss.starbug.com
#
# to run bash:      docker run -it --entrypoint /bin/bash nginx-ss.starbug.com
# to view logs:     docker logs nginx-00.starbug.com
#

FROM nginx

COPY ./public_html/ /opt/starbug.com/www/public_html/
COPY ./conf/nginx.conf /etc/nginx/nginx.conf

# TODO new conf per instance?
COPY ./conf/aai-nginx.selfsigned.conf /etc/nginx/conf.d/aai-nginx-00.conf

# self signed certs. /etc/ssl does not exist on default nginx
COPY ./ssl/certs/ /etc/ssl/certs/
COPY ./ssl/private/ /etc/ssl/private/


